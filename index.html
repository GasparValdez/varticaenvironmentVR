<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | VARTICAMetaverse</title>
    <meta name="description" content="">
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
  </head>
 <body>
    <div id="unity-container">
        <canvas id="unity-canvas"></canvas>
        <button id="btn-invisible-vr" style="position:fixed; top:0; left:0; width:100%; height:100%; opacity:0; z-index:999; display:none;"></button>
        
        <div id="unity-loading-bar">...</div> 
        <button id="entervr" style="display:none;" disabled></button>
    </div>

    <script>
        var unityInstance = null;
        var btnInvisible = document.getElementById('btn-invisible-vr');
        var btnRealVR = document.getElementById('entervr');

        // 1. Detectar cuando Unity está en escena VR
        document.addEventListener('onVRSupportedCheck', function (event) {
            btnRealVR.disabled = !event.detail.supported;
            // Si el VR es soportado, mostramos el botón invisible para capturar el clic
            if(event.detail.supported) {
                btnInvisible.style.display = "block";
            }
        }, false);

        // 2. Lógica del clic en el botón invisible
        btnInvisible.onclick = () => {
            // Ponemos pantalla completa siempre
            if (!document.fullscreenElement) {
                unityInstance.SetFullscreen(1);
            }

            // Si el sistema VR está listo, lo activamos
            if (!btnRealVR.disabled) {
                unityInstance.Module.WebXR.toggleVR();
                // Ocultamos el botón tras el uso para que no estorbe al juego
                btnInvisible.style.display = "none";
            }
        };

        // ... (Tu código de carga de Unity normal aquí abajo)
        createUnityInstance(canvas, config, (progress) => { ... }).then((instance) => {
            unityInstance = instance;
            // Si no estamos en VR, cualquier clic fuera del botón invisible pone Fullscreen
            window.addEventListener("mousedown", () => {
                if (!document.fullscreenElement) unityInstance.SetFullscreen(1);
            });
        });
    </script>
</body>
</html>
